#!/usr/bin/env python3
import os
import subprocess
import sys


def main() -> int:
    repo_root = "/home/mertrodop/406_project"
    datasets_dir = os.path.join(repo_root, "contree", "datasets")
    binary = os.path.join(repo_root, "contree", "build", "ConTree")

    max_depth = "2"
    max_thresholds = "128"

    if len(sys.argv) >= 2:
        max_depth = sys.argv[1]
    if len(sys.argv) >= 3:
        max_thresholds = sys.argv[2]

    if not os.path.isfile(binary):
        print(f"Binary not found: {binary}")
        return 1

    datasets = sorted(
        f for f in os.listdir(datasets_dir)
        if f.endswith(".txt")
    )
    if not datasets:
        print(f"No datasets found in {datasets_dir}")
        return 1

    for name in datasets:
        path = os.path.join(datasets_dir, name)
        print(f"=== {path} ===")
        cmd = [
            binary,
            "-file", path,
            "-max-depth", max_depth,
            "-use-gpu-bruteforce", "1",
            "-print-logs", "1",
            "-max-thresholds-per-feature", max_thresholds,
        ]
        subprocess.run(cmd, check=False)

    return 0


if __name__ == "__main__":
    raise SystemExit(main())
